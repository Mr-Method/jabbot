#!/usr/bin/env perl
use common::sense;
use FindBin;
use lib "$FindBin::Bin/../lib";

use Jabbot;
use Jabbot::RemoteCore;
use List::UtilsBy qw(rev_nsort_by);

use IO::Handle;
use encoding 'utf8';

my $j = Jabbot::RemoteCore->new;
my $ans = [];

if (@ARGV > 0) {
    my $q = join(" ", @ARGV);
    $ans = $j->answers(q => $q);
    say "\nA:";
    say "     [$_->{plugin}] $_->{body}" for @{$ans->{answers}};
}
else {
    STDOUT->autoflush(1);

    print "Q: ";
    while(<>) {
        chomp;
        my $q = $_;

        $ans = $j->answers(q => $q);

        say "A: ";
        say "    [$_->{plugin}] $_->{body}" for rev_nsort_by { $_->{score} } @{$ans->{answers}};
        print "\n";
        print "Q: ";
    }
}

