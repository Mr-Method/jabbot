#!/usr/bin/env perl
use common::sense;
use FindBin;
use lib "$FindBin::Bin/../lib";

use Jabbot::Core;
use IO::Handle;
use encoding 'utf8';

my $j = Jabbot::Core->new;
my $ans = [];

if (@ARGV > 0) {
    my $q = join(" ", @ARGV);
    $ans = $j->answers(question => $q, channel => ($ENV{CHANNEL} || '/console/jabbot:'));
    say "\nA:";
    say "     [$_->{plugin}] $_->{content}" for @$ans;
}
else {
    STDOUT->autoflush(1);

    print "Q: ";
    while(<>) {
        chomp;
        my $q = $_;

        $ans = $j->answers(question => $q, channel => ($ENV{CHANNEL} || '/console/jabbot:'));

        say "A: ";
        say "    [$_->{plugin}] $_->{content}" for @$ans;
        print "\n";
        print "Q: ";
    }
}

