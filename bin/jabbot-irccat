#!/usr/bin/env perl
use v5.18;
use FindBin;
use lib "$FindBin::Bin/../lib";

use JSON::PP qw(encode_json);
use Hijk;

use Getopt::Long;

GetOptions(
    (my $opt = {}),
    "network=s",
    "channel=s",
    "text=s"
);

my $res = Hijk::request({
    method       => "POST",
    host         => "localhost",
    port         => "18011",
    path         => "/",
    body => encode_json({
        network => $opt->{network},
        channel => $opt->{channel},
        text    => $opt->{text},
    })
});

if ($res->{error}) {
    say $res->{error};
} else {
    say "OK";
}
