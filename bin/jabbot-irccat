#!/usr/bin/env perl
use v5.18;
use JSON::PP qw(encode_json);
use Hijk;
use URI;

use FindBin;
use lib "$FindBin::Bin/../lib";

use Jabbot;

use Getopt::Long;

GetOptions(
    (my $opt = {}),
    "network=s",
    "channel=s",
    "text=s"
);

my $config = Jabbot->config->{ircbot};
my $uri = URI->new( $config->{listen} );

my $res = Hijk::request({
    method       => "POST",
    host         => $uri->host,
    port         => $uri->port,
    path         => "/",
    body => encode_json({
        network => $opt->{network},
        channel => $opt->{channel},
        text    => $opt->{text},
    })
});

if ($res->{error}) {
    say $res->{error};
} else {
    say "OK";
}
